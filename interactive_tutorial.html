

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Basic usage tutorial &mdash; qmflows 1.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="qmflows 1.0 documentation" href="index.html"/>
        <link rel="next" title="Further Reading" href="Further_reading.html"/>
        <link rel="prev" title="QMFlows" href="includeme.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> qmflows
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="includeme.html">QMFlows</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Basic usage tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Installation-in-Unix">Installation in Unix</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Starting-the-environment">Starting the environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#What-is-QMflows?">What is QMflows?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#The-basics:-calling-packages">The basics: calling packages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Note:">Note:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Settings-and-templates">Settings and templates</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Expert-info:">Expert info:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Combining-multiple-jobs">Combining multiple jobs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Further_reading.html">Further Reading</a></li>
<li class="toctree-l1"><a class="reference internal" href="documentation.html">Library Documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">qmflows</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Basic usage tutorial</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/interactive_tutorial.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 8ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

/* nice headers on first paragraph of info/warning boxes */
.admonition .first {
    margin: -12px;
    padding: 6px 12px;
    margin-bottom: 12px;
    color: #fff;
    line-height: 1;
    display: block;
}
.admonition.warning .first {
    background: #f0b37e;
}
.admonition.note .first {
    background: #6ab0de;
}
.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}
</style>
<div class="section" id="Basic-usage-tutorial">
<h1>Basic usage tutorial<a class="headerlink" href="#Basic-usage-tutorial" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Installation-in-Unix">
<h2>Installation in Unix<a class="headerlink" href="#Installation-in-Unix" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">conda installation. Type in your console the following command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh
</pre></div>
</div>
</li>
<li><p class="first">Then add miniconda to your path</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>./miniconda.sh -b -p <span class="nv">$HOME</span>/miniconda
</pre></div>
</div>
</li>
<li><p class="first">Create new virtual environment</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>conda create -q -n qmflows <span class="nv">python</span><span class="o">=</span><span class="m">3</span>.5
</pre></div>
</div>
</li>
<li><p class="first">Install dependecies</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>conda install --name qmflows -c anaconda hdf5
conda install --name qmflows -c https://conda.anaconda.org/rdkit rdkit
</pre></div>
</div>
</li>
<li><p class="first">Start environment</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">source</span> activate qmflows
</pre></div>
</div>
</li>
<li><p class="first">install <strong>qmflows</strong> dependencies</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>pip install https://github.com/SCM-NV/qmflows/tarball/master#egg<span class="o">=</span>qmflows https://github.com/SCM-NV/plams/tarball/master#egg<span class="o">=</span>plams --upgrade
</pre></div>
</div>
<p class="rubric" id="you-are-ready-to-start">You are ready to start!</p>
</li>
</ul>
</div>
<div class="section" id="Starting-the-environment">
<h2>Starting the environment<a class="headerlink" href="#Starting-the-environment" title="Permalink to this headline">¶</a></h2>
<p>Once <em>QMflows</em> has been installed the user should run the following
command to initialize the environment:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>user@int1 ~<span class="o">]</span>$ <span class="nb">source</span> activate qmflows
discarding /home/user/anaconda3/bin from PATH
prepending /home/user/anaconda3/envs/qmflows/bin to PATH
<span class="o">(</span>qmflows<span class="o">)[</span>user@int1 ~<span class="o">]</span>$ python --version
Python <span class="m">3</span>.5.2 :: Anaconda custom <span class="o">(</span><span class="m">64</span>-bit<span class="o">)</span>
</pre></div>
</div>
<p>To leave the environment the following command is used</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">(</span>qmflows<span class="o">)[</span>user@int1 ~<span class="o">]</span>$ <span class="nb">source</span> deactivate
discarding /home/user/anaconda3/envs/qmflows/bin from PATH
</pre></div>
</div>
<p>To finalize preparations before running QMflows: if you don’t want the
results to end up in the current work directory, create a new results
folder.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">mkdir</span> <span class="n">tutorial_results</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="What-is-QMflows?">
<h2>What is QMflows?<a class="headerlink" href="#What-is-QMflows?" title="Permalink to this headline">¶</a></h2>
<p>QMflows is a python library that enables executing complicated workflows
of interdependent quantum chemical (QM) calculations in python. It aims
at providing a common interface to multiple QM packages, enabling easy
and systematic generation of the calculation inputs, as well as
facilitating automatic analysis of the results. Furthermore it is build
on top of the powerful Noodles framework for executing the calculations
in parallel where possible.</p>
</div>
<div class="section" id="The-basics:-calling-packages">
<h2>The basics: calling packages<a class="headerlink" href="#The-basics:-calling-packages" title="Permalink to this headline">¶</a></h2>
<p>Currently <strong>QMFLOWS</strong> offers an interface with the following simulation
software:</p>
<ul class="simple">
<li><strong>SCM (ADF and DTFB)</strong></li>
<li><strong>CP2K</strong></li>
<li><strong>ORCA</strong></li>
<li><strong>GAMESS-US</strong></li>
<li><strong>DIRAC</strong></li>
</ul>
<div class="section" id="Note:">
<h3>Note:<a class="headerlink" href="#Note:" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Please make sure that the packages you want to use in QMflows are
installed and active; in most supercomputer the simulation package
are available using a command like (consult your system
administrator):</p>
<p><code class="docutils literal"><span class="pre">load</span> <span class="pre">module</span> <span class="pre">superAwesomeQuantumPackage/3.1421</span></code></p>
<p>Also some simulation packages required that you configure a
<em>scratch</em> folder. For instance <em>Orca</em> requires a <em>SCR</em> folder to be
defnied while <em>ADF</em> called it <em>SCM_TMPDIR</em>.</p>
</div></blockquote>
<p>With <code class="docutils literal"><span class="pre">qmflows</span></code> you can write a python script that simply calls one of
the package objects <code class="docutils literal"><span class="pre">adf,</span> <span class="pre">dftb,</span> <span class="pre">cp2k,</span> <span class="pre">orca,</span> <span class="pre">gamess</span> <span class="pre">or</span> <span class="pre">dirac</span></code>. As
arguments to the call, you need to provide a <code class="docutils literal"><span class="pre">settings</span></code> objects
defining the input of a calculation, a molecular geometry, and,
optionally, a job name that enables you to find back the “raw” data of
the calculation later on.</p>
<p>Let’s see how this works:</p>
<p>First we define a molecule, for example by reading one from an xyz file:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">scm.plams</span> <span class="k">import</span> <span class="n">Molecule</span>
<span class="n">acetonitrile</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">(</span><span class="s2">&quot;files/acetonitrile.xyz&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">acetonitrile</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
  Atoms:
    1         C      2.419290      0.606560      0.000000
    2         C      1.671470      1.829570      0.000000
    3         N      1.065290      2.809960      0.000000
    4         H      2.000000      0.000000      1.000000
    5         H      2.000000      0.000000     -1.000000
    6         H      3.600000      0.800000      0.000000

</pre></div></div>
</div>
<p>Then we can perform geometry optimization on the molecule by a call to
the dftb package object:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">qmflows</span> <span class="k">import</span> <span class="n">dftb</span><span class="p">,</span> <span class="n">templates</span><span class="p">,</span> <span class="n">run</span>
<span class="n">job</span> <span class="o">=</span> <span class="n">dftb</span><span class="p">(</span><span class="n">templates</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span> <span class="n">acetonitrile</span><span class="p">,</span> <span class="n">job_name</span><span class="o">=</span><span class="s2">&quot;dftb_geometry_optimization&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;noodles.interface.decorator.PromisedObject object at 0x7f3d9b62e358&gt;
</pre></div></div>
</div>
<p>As you can see, “job” is a so-called “promised object”. It means it
first needs to be “run” by the Noodles scheduler to return a normal
python object.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">result</span> <span class="o">=</span> <span class="n">run</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;tutorial_results&quot;</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s2">&quot;run_one&quot;</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="s2">&quot;tutorial_cache.json&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[09:14:04] PLAMS working folder: /home/lars/workspace/qmflows/jupyterNotebooks/tutorial_results/run_one
╭─(running jobs)
│ Running dftb dftb_geometry_optimization...
╰(<span style="color: rgb(60,180,100)">✔</span>)─(success)
&lt;qmflows.packages.SCM.DFTB_Result object at 0x7f6c8e30bcf8&gt;
</pre></div></div>
</div>
<p>We can easily retrieve the calculated properties from the DFTB
calculation such as the dipole or the optimized geometry for use in
subsequent calculations.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dipole: &quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">dipole</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">molecule</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Dipole:  [1.0864213029, -1.9278296041, -0.0]
  Atoms:
    1         C      2.366998      0.579794     -0.000000
    2         C      1.660642      1.834189      0.000000
    3         N      1.089031      2.847969      0.000000
    4         H      2.100157      0.010030      0.887206
    5         H      2.100157      0.010030     -0.887206
    6         H      3.439065      0.764079     -0.000000

</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Settings-and-templates">
<h2>Settings and templates<a class="headerlink" href="#Settings-and-templates" title="Permalink to this headline">¶</a></h2>
<p>In the above example <code class="docutils literal"><span class="pre">templates.geometry</span></code> was actually a predefined
Settings object. You can define and manipulate Settings in a completely
flexible manner as will be explained in this section. To facilitate
combining different packages in one script, QMflows defines a set of
commonly used generic keywords, which can be combined with package
specific keywords, to provide maximum flexibility.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">qmflows</span> <span class="k">import</span> <span class="n">Settings</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">Settings</span><span class="p">()</span>
<span class="n">s</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s2">&quot;DZP&quot;</span>
<span class="n">s</span><span class="o">.</span><span class="n">specific</span><span class="o">.</span><span class="n">adf</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">core</span> <span class="o">=</span> <span class="s2">&quot;large&quot;</span>
<span class="n">s</span><span class="o">.</span><span class="n">freeze</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
basis:  DZP
freeze:         [1, 2, 3]
specific:
         adf:
             basis:
                   core:        large

</pre></div></div>
</div>
<p>This code snippet illustrates that the <code class="docutils literal"><span class="pre">Settings</span></code> can be specified in
two ways, using generic or specific keywords. Generic keywords represent
input properties that are present in most simulation packages like a
<em>basis set</em> while <em>specific</em> keywords allow the user to apply specific
keywords for a package that are not in a generic dictionary.</p>
<div class="section" id="Expert-info:">
<h3>Expert info:<a class="headerlink" href="#Expert-info:" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><em>Settings</em> are a subclass of python
<a class="reference external" href="https://docs.python.org/3.5/tutorial/datastructures.html#dictionaries">dictionaries</a>
to represent herarchical structures, like</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="k">import</span> <span class="n">Image</span>
<span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;files/simpleTree.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/interactive_tutorial_20_0.png" src="_images/interactive_tutorial_20_0.png" />
<p>In QMflows/PLAMS multiple settings objects can be combined using the
<code class="docutils literal"><span class="pre">overlay</span></code> function.</p>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">merged_settings</span> <span class="o">=</span> <span class="n">templates</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">overlay</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">merged_settings</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
basis:  DZP
freeze:         [1, 2, 3]
specific:
         adf:
             basis:
                   core:        large
                   type:        SZ
             geometry:
                      optim:    delocal
             integration:
                         accint:        6.0
             scf:
                 converge:      1e-06
                 iterations:    100
             xc:
                __block_replace:        True
                lda:
         cp2k:
              force_eval:
                         dft:
                             basis_set_file_name:
                             mgrid:
                                   cutoff:      400
                                   ngrids:      4
                             potential_file_name:
                             qs:
                                method:         gpw
                             scf:
                                 OT:
                                    N_DIIS:     7
                                    minimizer:  DIIS
                                    preconditioner:     full_single_inverse
                                 eps_scf:       1e-06
                                 max_scf:       200
                                 scf_guess:     atomic
                             xc:
                                xc_functional:  pbe
                         subsys:
                                cell:
                                     periodic:  xyz
              global:
                     print_level:       low
                     project:   qmflows-cp2k
                     run_type:  geometry_optimization
              motion:
                     geo_opt:
                             max_iter:  500
                             optimizer:         bfgs
                             type:      minimization
         dftb:
              dftb:
                   resourcesdir:        DFTB.org/3ob-3-1
              task:
                   runtype:     GO
         dirac:
         gamess:
                basis:
                      gbasis:   n21
                      ngauss:   3
                contrl:
                       dfttyp:  pbe
                       runtyp:  optimize
                       scftyp:  rhf
         orca:
              basis:
                    basis:      sto_sz
              method:
                     functional:        lda
                     method:    dft
                     runtyp:    opt

</pre></div></div>
</div>
<p>The <em>overlay</em> method merged the template containing default settings for
geometry optimizations with different packages with the arguments
provided by the user</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;files/merged.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/interactive_tutorial_24_0.png" src="_images/interactive_tutorial_24_0.png" />
</div>
</div>
<p><strong>resulting in:</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>

<span></span><span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;files/result_merged.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/interactive_tutorial_26_0.png" src="_images/interactive_tutorial_26_0.png" />
</div>
</div>
<p>Note that the generic and specific keywords still exist next to each
other and may not be consistent (e.g. different basis sets are defined
in generic and specific keywords). Upon calling a package with a
Settings object, the generic keywords are first translated into package
specific keywords and combined with the relevant user defined specific
keywords. In this step, the settings defined in generic keywords take
preference. Subsequently, the input file(s) for the given package is/are
generated, based on the keywords after <strong>specific.[package]</strong> based on
the <a class="reference external" href="https://www.scm.com/doc/plams/index.html">PLAMS software</a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">qmflows</span> <span class="k">import</span> <span class="n">adf</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adf</span><span class="o">.</span><span class="n">generic2specific</span><span class="p">(</span><span class="n">merged_settings</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
basis:  DZP
freeze:         [1, 2, 3]
specific:
         adf:
             basis:
                   core:        large
                   type:        DZP
             constraints:
                         atom 2:
                         atom 3:
                         atom 4:
             geometry:
                      optim:    cartesian
             integration:
                         accint:        6.0
             scf:
                 converge:      1e-06
                 iterations:    100
             xc:
                __block_replace:        True
                lda:
         cp2k:
              force_eval:
                         dft:
                             basis_set_file_name:
                             mgrid:
                                   cutoff:      400
                                   ngrids:      4
                             potential_file_name:
                             qs:
                                method:         gpw
                             scf:
                                 OT:
                                    N_DIIS:     7
                                    minimizer:  DIIS
                                    preconditioner:     full_single_inverse
                                 eps_scf:       1e-06
                                 max_scf:       200
                                 scf_guess:     atomic
                             xc:
                                xc_functional:  pbe
                         subsys:
                                cell:
                                     periodic:  xyz
              global:
                     print_level:       low
                     project:   qmflows-cp2k
                     run_type:  geometry_optimization
              motion:
                     geo_opt:
                             max_iter:  500
                             optimizer:         bfgs
                             type:      minimization
         dftb:
              dftb:
                   resourcesdir:        DFTB.org/3ob-3-1
              task:
                   runtype:     GO
         dirac:
         gamess:
                basis:
                      gbasis:   n21
                      ngauss:   3
                contrl:
                       dfttyp:  pbe
                       runtyp:  optimize
                       scftyp:  rhf
         orca:
              basis:
                    basis:      sto_sz
              method:
                     functional:        lda
                     method:    dft
                     runtyp:    opt

</pre></div></div>
</div>
<p>In the case of adf the above keywords result in the following input file
for ADF package:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">adf_job</span> <span class="o">=</span> <span class="n">adf</span><span class="p">(</span><span class="n">merged_settings</span><span class="p">,</span> <span class="n">acetonitrile</span><span class="p">,</span> <span class="n">job_name</span><span class="o">=</span><span class="s1">&#39;adf_acetonitrile&#39;</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">run</span><span class="p">(</span><span class="n">adf_job</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;tutorial_results&quot;</span><span class="p">,</span>
             <span class="n">folder</span><span class="o">=</span><span class="s2">&quot;run_two&quot;</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="s2">&quot;tutorial_cache.json&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;tutorial_results/run_two/adf_acetonitrile/adf_acetonitrile.in&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[09:14:04] PLAMS working folder: /home/lars/workspace/qmflows/jupyterNotebooks/tutorial_results/run_two
╭─(running jobs)
│ Running adf adf_acetonitrile...
(<span style="color: rgb(60,180,100)">✔</span>)╰─(success)
atoms
      1         C      2.419290      0.606560      0.000000
      2         C      1.671470      1.829570      0.000000
      3         N      1.065290      2.809960      0.000000
      4         H      2.000000      0.000000      1.000000
      5         H      2.000000      0.000000     -1.000000
      6         H      3.600000      0.800000      0.000000
end

basis
  core large
  type DZP
end

constraints
  atom 2
  atom 3
  atom 4
end

geometry
  optim cartesian
end

integration
  accint 6.0
end

scf
  converge 1e-06
  iterations 100
end

xc
  lda
end

end input

</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Combining-multiple-jobs">
<h2>Combining multiple jobs<a class="headerlink" href="#Combining-multiple-jobs" title="Permalink to this headline">¶</a></h2>
<p>Multiple jobs can be combined, while calling the run function only once.
The script below combines components outlined above:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">plams</span> <span class="k">import</span> <span class="n">Molecule</span>
<span class="kn">from</span> <span class="nn">qmflows</span> <span class="k">import</span> <span class="n">dftb</span><span class="p">,</span> <span class="n">adf</span><span class="p">,</span> <span class="n">templates</span><span class="p">,</span> <span class="n">run</span><span class="p">,</span> <span class="n">Settings</span>

<span class="n">acetonitrile</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">(</span><span class="s2">&quot;files/acetonitrile.xyz&quot;</span><span class="p">)</span>

<span class="n">dftb_opt</span> <span class="o">=</span> <span class="n">dftb</span><span class="p">(</span><span class="n">templates</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span> <span class="n">acetonitrile</span><span class="p">,</span> <span class="n">job_name</span><span class="o">=</span><span class="s2">&quot;dftb_opt&quot;</span><span class="p">)</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">Settings</span><span class="p">()</span>
<span class="n">s</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s2">&quot;DZP&quot;</span>
<span class="n">s</span><span class="o">.</span><span class="n">specific</span><span class="o">.</span><span class="n">adf</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">core</span> <span class="o">=</span> <span class="s2">&quot;large&quot;</span>
<span class="n">adf_single</span> <span class="o">=</span> <span class="n">adf</span><span class="p">(</span><span class="n">templates</span><span class="o">.</span><span class="n">singlepoint</span><span class="o">.</span><span class="n">overlay</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">dftb_opt</span><span class="o">.</span><span class="n">molecule</span><span class="p">,</span> <span class="n">job_name</span><span class="o">=</span><span class="s2">&quot;adf_single&quot;</span><span class="p">)</span>

<span class="n">adf_result</span> <span class="o">=</span> <span class="n">run</span><span class="p">(</span><span class="n">adf_single</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;tutorial_results&quot;</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s2">&quot;workflow&quot;</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="s2">&quot;tutorial_cache.json&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adf_result</span><span class="o">.</span><span class="n">molecule</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adf_result</span><span class="o">.</span><span class="n">energy</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[09:15:08] PLAMS working folder: /home/lars/workspace/qmflows/jupyterNotebooks/tutorial_results/workflow
╭─(running jobs)
│ Running dftb dftb_opt...
(<span style="color: rgb(60,180,100)">✔</span>)│ Running adf adf_single...
(<span style="color: rgb(60,180,100)">✔</span>)╰─(success)
  Atoms:
    1         C      0.000000      0.000000      0.656511
    2         C      0.000000      0.000000     -0.783088
    3         N      0.000000      0.000000     -1.946913
    4         H     -0.512221     -0.887193      1.022016
    5         H      1.024442      0.000000      1.022016
    6         H     -0.512221      0.887193      1.022016

-1.4094874734528888
</pre></div></div>
</div>
<p>In this case the second task adf_single reads the molecule optimized in
the first job dftb_opt. Note that dftb_opt as well as
dftb_opt.molecule are promised objects. When <strong>run</strong> is applied to the
adf_single job, noodles builds a graph of dependencies and makes sure
all the calculations required to obtain <strong>adf_result</strong> are performed.</p>
<p>All data related to the calculations, i.e. input files generated by
QMflows and the resulting output files generated by the QM packages are
stored in folders named after the job_names, residing inside a results
folder:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">ls</span> <span class="n">tutorial_results</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-blue-intense-fg ansi-bold">run_one</span>/  <span class="ansi-blue-intense-fg ansi-bold">run_two</span>/  <span class="ansi-blue-intense-fg ansi-bold">workflow</span>/
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">ls</span> <span class="n">tutorial_results</span><span class="o">/</span><span class="n">workflow</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-blue-intense-fg ansi-bold">adf_single</span>/  <span class="ansi-blue-intense-fg ansi-bold">dftb_opt</span>/  workflow.log
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">ls</span> <span class="n">tutorial_results</span><span class="o">/</span><span class="n">workflow</span><span class="o">/</span><span class="n">adf_single</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
adf_single.dill  adf_single.in   <span class="ansi-green-intense-fg ansi-bold">adf_single.run</span>*  logfile  t21.H
adf_single.err   adf_single.out  adf_single.t21   t21.C    t21.N
</pre></div></div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Further_reading.html" class="btn btn-neutral float-right" title="Further Reading" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="includeme.html" class="btn btn-neutral" title="QMFlows" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, F. Zapata, L. Ridder.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>